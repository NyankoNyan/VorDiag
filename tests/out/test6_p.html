<!DOCTYPE html>
<html>
 <head>
  <title>canvas</title>
  <meta charset="utf-8">
  <script> 
var outputRepr = {"size":{"x":700,"y":700},"camera":[[0.29166666,0,0],[0,-0.29166666,0],[350,495.8333,1]],"edges":[],"rays":[],"dots":[{"x":885.8594,"y":168.44559},{"x":495.01096,"y":232.10526},{"x":556.9709,"y":852.16504},{"x":630.22455,"y":497.9883},{"x":167.84134,"y":470.53317},{"x":820.3649,"y":325.2506},{"x":781.499,"y":854.6988},{"x":137.15855,"y":386.42377},{"x":852.3088,"y":817.29126},{"x":457.20148,"y":196.43071},{"x":740.8521,"y":381.4711},{"x":729.3358,"y":405.19516},{"x":735.96454,"y":108.90939},{"x":488.9201,"y":389.60043},{"x":405.82706,"y":523.9745},{"x":142.7266,"y":649.0722},{"x":359.4861,"y":353.63818},{"x":163.27603,"y":724.7514},{"x":161.30345,"y":345.56097},{"x":571.65564,"y":187.70761},{"x":159.35019,"y":126.13594},{"x":161.93382,"y":890.28937},{"x":373.51648,"y":864.9282},{"x":262.96088,"y":583.7626},{"x":175.62762,"y":154.53844},{"x":297.12592,"y":495.32892},{"x":100.43991,"y":708.1273},{"x":736.36597,"y":604.38824},{"x":339.10974,"y":189.8158},{"x":396.14072,"y":548.06146},{"x":463.24493,"y":340.62415},{"x":192.16125,"y":543.8668},{"x":427.80658,"y":271.29272},{"x":865.7645,"y":527.8608},{"x":791.4228,"y":312.40717},{"x":325.1203,"y":606.7478},{"x":345.63565,"y":369.49387},{"x":137.08052,"y":714.7162},{"x":319.53726,"y":739.0465},{"x":131.67867,"y":771.0363},{"x":745.9485,"y":805.1576}],"polygons":[{"dots":[{"x":429.20865,"y":-500},{"x":433.15646,"y":-367.85718},{"x":484.12692,"y":-205.51242},{"x":692.9564,"y":229.93593},{"x":784.5833,"y":204.96544},{"x":1000,"y":-337.39142},{"x":1000,"y":-500}]},{"dots":[{"x":433.15646,"y":-367.85718},{"x":429.20865,"y":-500},{"x":-1000,"y":-500},{"x":-1000,"y":158.3819},{"x":-67.59077,"y":237.8773},{"x":-1.6851717,"y":237.29063},{"x":277.8927,"y":77.06491},{"x":428.46555,"y":-347.98175}]},{"dots":[{"x":277.8927,"y":77.06491},{"x":-1.6851717,"y":237.29063},{"x":239.4167,"y":255.37012}]},{"dots":[{"x":1000,"y":-337.39142},{"x":784.5833,"y":204.96544},{"x":840.2249,"y":241.46536},{"x":1000,"y":308.20035}]},{"dots":[{"x":692.9564,"y":229.93593},{"x":484.12692,"y":-205.51242},{"x":513.1298,"y":175.02869},{"x":594.09607,"y":314.80255},{"x":612.85175,"y":322.48865},{"x":667.5344,"y":274.739}]},{"dots":[{"x":428.46555,"y":-347.98175},{"x":277.8927,"y":77.06491},{"x":239.4167,"y":255.37012},{"x":263.13177,"y":282.4444},{"x":345.16464,"y":272.2411},{"x":396.8772,"y":215.9459}]},{"dots":[{"x":484.12692,"y":-205.51242},{"x":433.15646,"y":-367.85718},{"x":428.46555,"y":-347.98175},{"x":396.8772,"y":215.9459},{"x":453.53284,"y":238.19223},{"x":513.1298,"y":175.02869}]},{"dots":[{"x":513.1298,"y":175.02869},{"x":453.53284,"y":238.19223},{"x":482.1361,"y":287.24527},{"x":573.5647,"y":314.00858},{"x":594.09607,"y":314.80255}]},{"dots":[{"x":453.53284,"y":238.19223},{"x":396.8772,"y":215.9459},{"x":345.16464,"y":272.2411},{"x":408.57065,"y":324.84784},{"x":482.1361,"y":287.24527}]},{"dots":[{"x":840.2249,"y":241.46536},{"x":784.5833,"y":204.96544},{"x":692.9564,"y":229.93593},{"x":667.5344,"y":274.739},{"x":786.72876,"y":362.01672}]},{"dots":[{"x":840.2249,"y":241.46536},{"x":786.72876,"y":362.01672},{"x":833.8256,"y":428.62598},{"x":1000,"y":391.39053},{"x":1000,"y":308.20035}]},{"dots":[{"x":482.1361,"y":287.24527},{"x":408.57065,"y":324.84784},{"x":417.47452,"y":395.83707},{"x":573.5647,"y":314.00858}]},{"dots":[{"x":239.4167,"y":255.37012},{"x":-1.6851717,"y":237.29063},{"x":-67.59077,"y":237.8773},{"x":215.86317,"y":405.3638},{"x":247.47337,"y":403.7101},{"x":263.09235,"y":283.4119},{"x":263.13177,"y":282.4444}]},{"dots":[{"x":408.57065,"y":324.84784},{"x":345.16464,"y":272.2411},{"x":263.13177,"y":282.4444},{"x":263.09235,"y":283.4119},{"x":412.45883,"y":413.8889},{"x":417.47452,"y":395.83707}]},{"dots":[{"x":412.45883,"y":413.8889},{"x":263.09235,"y":283.4119},{"x":247.47337,"y":403.7101},{"x":247.62604,"y":403.97873},{"x":367.1787,"y":450.0666},{"x":409.7075,"y":433.49582}]},{"dots":[{"x":786.72876,"y":362.01672},{"x":667.5344,"y":274.739},{"x":612.85175,"y":322.48865},{"x":613.2289,"y":334.1775},{"x":824.38806,"y":436.67886},{"x":833.8256,"y":428.62598}]},{"dots":[{"x":215.86317,"y":405.3638},{"x":-67.59077,"y":237.8773},{"x":-1000,"y":158.3819},{"x":-1000,"y":419.5779},{"x":-103.57613,"y":521.89404}]},{"dots":[{"x":573.5647,"y":314.00858},{"x":417.47452,"y":395.83707},{"x":412.45883,"y":413.8889},{"x":409.7075,"y":433.49582},{"x":516.71545,"y":499.66647},{"x":610.41815,"y":377.5071},{"x":613.2289,"y":334.1775},{"x":612.85175,"y":322.48865},{"x":594.09607,"y":314.80255}]},{"dots":[{"x":824.38806,"y":436.67886},{"x":613.2289,"y":334.1775},{"x":610.41815,"y":377.5071},{"x":729.693,"y":504.90305},{"x":764.1394,"y":503.6874}]},{"dots":[{"x":215.86317,"y":405.3638},{"x":-103.57613,"y":521.89404},{"x":-93.12058,"y":524.8601},{"x":61.264465,"y":546.57715},{"x":231.07776,"y":490.26132},{"x":247.62604,"y":403.97873},{"x":247.47337,"y":403.7101}]},{"dots":[{"x":367.1787,"y":450.0666},{"x":247.62604,"y":403.97873},{"x":231.07776,"y":490.26132},{"x":248.17456,"y":527.23376},{"x":310.31604,"y":551.24115},{"x":334.07745,"y":545.271},{"x":349.93787,"y":515.49036}]},{"dots":[{"x":729.693,"y":504.90305},{"x":610.41815,"y":377.5071},{"x":516.71545,"y":499.66647},{"x":526.78357,"y":586.60706},{"x":543.4913,"y":664.71295},{"x":565.02844,"y":669.1677}]},{"dots":[{"x":409.7075,"y":433.49582},{"x":367.1787,"y":450.0666},{"x":349.93787,"y":515.49036},{"x":526.78357,"y":586.60706},{"x":516.71545,"y":499.66647}]},{"dots":[{"x":1000,"y":391.39053},{"x":833.8256,"y":428.62598},{"x":824.38806,"y":436.67886},{"x":764.1394,"y":503.6874},{"x":864.1625,"y":672.81433},{"x":1000,"y":679.1295}]},{"dots":[{"x":231.07776,"y":490.26132},{"x":61.264465,"y":546.57715},{"x":200.42674,"y":611.9677},{"x":248.17456,"y":527.23376}]},{"dots":[{"x":526.78357,"y":586.60706},{"x":349.93787,"y":515.49036},{"x":334.07745,"y":545.271},{"x":443.77383,"y":678.02216},{"x":486.17157,"y":695.0277},{"x":543.4913,"y":664.71295}]},{"dots":[{"x":310.31604,"y":551.24115},{"x":248.17456,"y":527.23376},{"x":200.42674,"y":611.9677},{"x":229.807,"y":666.05646},{"x":246.35944,"y":677.7597},{"x":266.20602,"y":670.52875}]},{"dots":[{"x":764.1394,"y":503.6874},{"x":729.693,"y":504.90305},{"x":565.02844,"y":669.1677},{"x":622.05695,"y":710.4574},{"x":811.6566,"y":701.4081},{"x":864.1625,"y":672.81433}]},{"dots":[{"x":334.07745,"y":545.271},{"x":310.31604,"y":551.24115},{"x":266.20602,"y":670.52875},{"x":443.77383,"y":678.02216}]},{"dots":[{"x":200.42674,"y":611.9677},{"x":61.264465,"y":546.57715},{"x":-93.12058,"y":524.8601},{"x":124.31114,"y":680.55304},{"x":163.88408,"y":683.9567},{"x":229.807,"y":666.05646}]},{"dots":[{"x":124.31114,"y":680.55304},{"x":-93.12058,"y":524.8601},{"x":-103.57613,"y":521.89404},{"x":-1000,"y":419.5779},{"x":-1000,"y":1181.0721},{"x":-291.08743,"y":941.75885},{"x":113.464676,"y":740.8702}]},{"dots":[{"x":163.88408,"y":683.9567},{"x":124.31114,"y":680.55304},{"x":113.464676,"y":740.8702},{"x":141.06696,"y":743.51764}]},{"dots":[{"x":163.88408,"y":683.9567},{"x":141.06696,"y":743.51764},{"x":234.50813,"y":807.30725},{"x":246.35944,"y":677.7597},{"x":229.807,"y":666.05646}]},{"dots":[{"x":443.77383,"y":678.02216},{"x":266.20602,"y":670.52875},{"x":246.35944,"y":677.7597},{"x":234.50813,"y":807.30725},{"x":234.68855,"y":808.36664},{"x":262.95627,"y":837.8232},{"x":457.98373,"y":754.19366},{"x":486.17157,"y":695.0277}]},{"dots":[{"x":141.06696,"y":743.51764},{"x":113.464676,"y":740.8702},{"x":-291.08743,"y":941.75885},{"x":234.68855,"y":808.36664},{"x":234.50813,"y":807.30725}]},{"dots":[{"x":811.6566,"y":701.4081},{"x":622.05695,"y":710.4574},{"x":668.73096,"y":898.09454},{"x":799.96155,"y":803.92413}]},{"dots":[{"x":864.1625,"y":672.81433},{"x":811.6566,"y":701.4081},{"x":799.96155,"y":803.92413},{"x":1000,"y":1182.5828},{"x":1000,"y":679.1295}]},{"dots":[{"x":565.02844,"y":669.1677},{"x":543.4913,"y":664.71295},{"x":486.17157,"y":695.0277},{"x":457.98373,"y":754.19366},{"x":509.8705,"y":1500},{"x":661.9386,"y":1500},{"x":668.73096,"y":898.09454},{"x":622.05695,"y":710.4574}]},{"dots":[{"x":799.96155,"y":803.92413},{"x":668.73096,"y":898.09454},{"x":661.9386,"y":1500},{"x":999.99994,"y":1500},{"x":1000,"y":1182.5828}]},{"dots":[{"x":457.98373,"y":754.19366},{"x":262.95627,"y":837.8232},{"x":342.32736,"y":1500},{"x":509.8705,"y":1500}]},{"dots":[{"x":234.68855,"y":808.36664},{"x":-291.08743,"y":941.75885},{"x":-1000,"y":1181.0721},{"x":-1000.00006,"y":1500},{"x":342.32736,"y":1500},{"x":262.95627,"y":837.8232}]}],"arcs":[],"circles":[],"lines":[]};
var camera = [[1,0,0],[0,1,0],[0,0,1]];
var reverseCamera;

var matrixMult = function(x,y,m){
	return {
		"x":m[0][0]*x+m[1][0]*y+m[2][0],
		"y":m[0][1]*x+m[1][1]*y+m[2][1]
	};
};
var coordToCamera = function(x,y){
	return matrixMult(x,y,camera);
};
var scaleCoord = function(x,y){
	var c = camera;
	return {
		"x":c[0][0]*x+c[1][0]*y,
		"y":c[0][1]*x+c[1][1]*y
	};
}
var polygonColors = ["#CD5C5C", "#ADFF2F", "#7B68EE", "#FFA500",
"#F08080", "#00FF00", "#4682B4", "#A52A2A",
"#E9967A", "#32CD32", "#87CEFA", "#D2691E",
"#DC143C", "#00FA9A", "#4169E1",
"#B22222", "#9ACD32", "#FFD700",
"#FF69B4", "#808000", "#FFDAB9",
"#C71585", "#66CDAA", "#F0E68C",
"#DB7093", "#008B8B", "#9370DB"]; 
var getRayMult = function(){
	return 1000/(Math.abs(camera[0][0])+Math.abs(camera[0][1])+Math.abs(camera[1][0])+Math.abs(camera[1][1]));
};

var getMinor = function(m, x, y){
	var x1 = (x+1)%3;
	var x2 = (x+2)%3;
	var y1 = (y+1)%3;
	var y2 = (y+2)%3;
	return m[x1][y1]*m[x2][y2] - m[x1][y2]*m[x2][y1];
};
var getMinorMatrix = function(m){
	var result = [];
	for(var i = 0; i < 3; i++){
		result[i] = [];
		for(var j = 0; j < 3; j++){
			result[i][j] = getMinor(m, i, j);
		}
	}
	return result;
};
var backMatrix = function(m){	
	var mmin = getMinorMatrix(m);	
	var det = m[0][0] * mmin[0][0] - m[0][1] * mmin[0][1] + m[0][2] * mmin[0][2];	
	var result = [];
	for(var i = 0; i < 3; i++){
		result[i] = [];
		for(var j = 0; j < 3; j++){
			result[i][j] = mmin[j][i] / det * ((i+j)%2==0?1:-1);
		}
	}
	return result;		
};
window.onload = function() {
	var drawingCanvas = document.getElementById('smile');
	var coord;
	if(drawingCanvas && drawingCanvas.getContext) {
		var context = drawingCanvas.getContext('2d');
		if(outputRepr.camera!==undefined){
			for(var i = 0; i < 3; i++){
				for(var j = 0; j < 3; j++){
					if(outputRepr.camera[i][j] !== undefined){
						camera[i][j] = outputRepr.camera[i][j];
					}
				}
			}
		}
		reverseCamera = backMatrix(camera);
		if(outputRepr.size!==undefined){
			drawingCanvas.width = outputRepr.size.x;
			drawingCanvas.height = outputRepr.size.y;
		}
		var rayMult = getRayMult();		
		var minCorner = matrixMult(0, 0, reverseCamera);
		var maxCorner = matrixMult(drawingCanvas.width, drawingCanvas.height, reverseCamera);
		var xMin = Math.min(minCorner.x, maxCorner.x);
		var xMax = Math.max(minCorner.x, maxCorner.x);
		var xStep = (xMax - xMin) / drawingCanvas.width;
		var yMin = Math.min(minCorner.y, maxCorner.y);
		var yMax = Math.max(minCorner.y, maxCorner.y);
		
		context.shadowColor = "rgba(0,0,0,.5)";
		context.shadowBlur = 2;
		context.lineCap = 'round';
		context.lineJoin = 'round';
		context.lineWidth = 1;
		
		if(outputRepr.polygons!==undefined){
			for(var polyId = 0; polyId < outputRepr.polygons.length; polyId++){
				var poly = outputRepr.polygons[polyId];
				context.fillStyle = polygonColors[polyId % polygonColors.length];				
				
				context.beginPath();
				coord = coordToCamera(poly.dots[0].x, poly.dots[0].y);
				context.moveTo(coord.x, coord.y);
				for(var dotId = 1; dotId < poly.dots.length; dotId++){
					coord = coordToCamera(poly.dots[dotId].x, poly.dots[dotId].y);
					context.lineTo(coord.x, coord.y);
				}
				context.closePath();
				context.fill();
			}
		}
		if(outputRepr.edges!==undefined){
			context.strokeStyle = "#AA0";
			
			outputRepr.edges.forEach((elem)=>{				
				context.beginPath();
				coord = coordToCamera(elem.x1, elem.y1);
				context.moveTo(coord.x, coord.y);
				coord = coordToCamera(elem.x2, elem.y2);
				context.lineTo(coord.x, coord.y);				
				context.stroke();
			});
		}
		if(outputRepr.rays!==undefined){
			context.strokeStyle = "#0AA";
			
			outputRepr.rays.forEach((elem)=>{				
				context.beginPath();
				coord = coordToCamera(elem.x, elem.y);
				context.moveTo(coord.x, coord.y);
				var rayCoord = coordToCamera(elem.x+elem.dx*rayMult, elem.y+elem.dy*rayMult);
				context.lineTo(rayCoord.x, rayCoord.y);
				context.lineCap = 'round';
				context.stroke();
			});
		}	
		if(outputRepr.lines!==undefined){
			context.strokeStyle = "#AAA";
			
			outputRepr.lines.forEach((elem)=>{
				var x, y;
				var coord1, coord2;
				if(Math.abs(elem.dx) > Math.abs(elem.dy)){
					coord1 = coordToCamera((-elem.dy * yMin - elem.c) / elem.dx, yMin);
					coord2 = coordToCamera((-elem.dy * yMax - elem.c) / elem.dx, yMax);
				}else{
					coord1 = coordToCamera(xMin, (-elem.dx * xMin - elem.c) / elem.dy);
					coord2 = coordToCamera(xMax, (-elem.dx * xMax - elem.c) / elem.dy);
				}
				context.beginPath();
				context.moveTo(coord1.x, coord1.y);
				context.lineTo(coord2.x, coord2.y);
				context.stroke();
			});
		}
		if(outputRepr.circles!==undefined){
			context.setLineDash([5,5]);
			context.strokeStyle = "#A00";
			
			outputRepr.circles.forEach((elem)=>{
				var coord = coordToCamera(elem.x, elem.y);
				var size = scaleCoord(1, 1);
				context.beginPath();
				context.ellipse(coord.x, coord.y, elem.r*Math.abs(size.x), elem.r*Math.abs(size.y), 0, 0, Math.PI*2);
				context.stroke();
			});
			context.setLineDash([]);
		}
		if(outputRepr.arcs!==undefined){
			context.strokeStyle = "#00A";

			outputRepr.arcs.forEach((elem)=>{
				context.beginPath();
				drawMinX = Math.max(elem.minX, xMin);
				drawMaxX = Math.min(elem.maxX, xMax);
				var count = 0;
				for(var x = drawMinX; x < drawMaxX+xStep; x += xStep){
					var y = .5 * ((x - elem.fX) * (x - elem.fX) 
						+ elem.fY * elem.fY - elem.dirY * elem.dirY)
						/ (elem.fY - elem.dirY);
					var coord = coordToCamera(x,y);
					if(count==0){
						context.moveTo(coord.x, coord.y);
					}else{
						context.lineTo(coord.x, coord.y);
					}
					count++;
				}
				//context.closePath();
				context.stroke();
			});
		}
		if(outputRepr.dots!==undefined){
			context.fillStyle = "#FFF";
			context.strokeStyle = "#000";
			
			outputRepr.dots.forEach((elem)=>{				
				coord = coordToCamera(elem.x, elem.y);
				context.beginPath();
				context.arc(coord.x, coord.y, 3, 0, Math.PI*2);
				context.fill();
				context.stroke();				
			});
		}
	}
}
  </script>
 </head>
 <body>
  <canvas id="smile" width="200" height="200">
    <p>Ваш браузер не поддерживает рисование.</p>
  </canvas>
 </body>
</html>