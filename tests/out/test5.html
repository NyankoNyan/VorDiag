<!DOCTYPE html>
<html>
 <head>
  <title>canvas</title>
  <meta charset="utf-8">
  <script> 
outputRepr = {"size":{"x":700,"y":700},"camera":[[116.666664,0,0],[0,-116.666664,0],[58.333332,641.6666,1]],"edges":[{"x1":2,"y1":2,"x2":0,"y2":0},{"x1":2,"y1":2,"x2":0,"y2":4},{"x1":2,"y1":2,"x2":5,"y2":2},{"x1":5,"y1":2,"x2":2,"y2":5},{"x1":0,"y1":0,"x2":0,"y2":4},{"x1":0,"y1":4,"x2":0,"y2":5},{"x1":5,"y1":5,"x2":5,"y2":2},{"x1":5,"y1":2,"x2":5,"y2":0},{"x1":5,"y1":0,"x2":0,"y2":0},{"x1":0,"y1":5,"x2":2,"y2":5},{"x1":2,"y1":5,"x2":5,"y2":5}],"rays":[],"dots":[{"x":2,"y":1},{"x":1,"y":2},{"x":2,"y":3},{"x":4,"y":5}]};
camera = [[1,0,0],[0,1,0],[0,0,1]];
coordToCamera = function(x,y){
	var c = camera;
	return {
		"x":c[0][0]*x+c[1][0]*y+c[2][0],
		"y":c[0][1]*x+c[1][1]*y+c[2][1]
	};
};
getRayMult = function(){
	return 1000/(Math.abs(camera[0][0])+Math.abs(camera[0][1])+Math.abs(camera[1][0])+Math.abs(camera[1][1]));
};
window.onload = function() {
	var drawingCanvas = document.getElementById('smile');
	var coord;
	if(drawingCanvas && drawingCanvas.getContext) {
		var context = drawingCanvas.getContext('2d');
		if(outputRepr.camera!==undefined){
			for(var i = 0; i < 3; i++){
				for(var j = 0; j < 3; j++){
					if(outputRepr.camera[i][j] !== undefined){
						camera[i][j] = outputRepr.camera[i][j];
					}
				}
			}
		}
		if(outputRepr.size!==undefined){
			drawingCanvas.width = outputRepr.size.x;
			drawingCanvas.height = outputRepr.size.y;
		}
		var rayMult = getRayMult();		
		if(outputRepr.edges!==undefined){
			outputRepr.edges.forEach((elem)=>{
				context.shadowColor = "rgba(0,0,0,.5)";
				context.shadowBlur = 2;
				context.lineCap = 'round';
				context.lineJoin = 'round';
				context.lineWidth = 1;
				context.beginPath();
				coord = coordToCamera(elem.x1, elem.y1);
				context.moveTo(coord.x, coord.y);
				coord = coordToCamera(elem.x2, elem.y2);
				context.lineTo(coord.x, coord.y);				
				context.stroke();
			});
		}
		if(outputRepr.rays!==undefined){
			outputRepr.rays.forEach((elem)=>{
				context.shadowColor = "rgba(0,0,0,.5)";
				context.shadowBlur = 2;
				context.lineCap = 'round';
				context.lineJoin = 'round';
				context.lineWidth = 1;
				context.beginPath();
				coord = coordToCamera(elem.x, elem.y);
				context.moveTo(coord.x, coord.y);
				var rayCoord = coordToCamera(elem.x+elem.dx*rayMult, elem.y+elem.dy*rayMult);
				context.lineTo(rayCoord.x, rayCoord.y);
				context.lineCap = 'round';
				context.stroke();
			});
		}			
		if(outputRepr.dots!==undefined){
			outputRepr.dots.forEach((elem)=>{
				context.shadowColor = "rgba(0,0,0,.5)";
				context.shadowBlur = 2;
				context.lineCap = 'round';
				context.lineJoin = 'round';
				context.lineWidth = 1;
				context.beginPath();
				coord = coordToCamera(elem.x, elem.y);
				context.beginPath();
				context.arc(coord.x, coord.y, 3, 0, Math.PI*2);
				context.fill();
			});
		}
	}
}
  </script>
 </head>
 <body>
  <canvas id="smile" width="200" height="200">
    <p>Ваш браузер не поддерживает рисование.</p>
  </canvas>
 </body>
</html>