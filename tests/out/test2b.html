<!DOCTYPE html>
<html>
 <head>
  <title>canvas</title>
  <meta charset="utf-8">
  <script> 
var outputRepr = {"size":{"x":700,"y":700},"camera":[[145.83333,0,0],[0,-97.22222,0],[-306.24997,544.44446,1]],"edges":[],"rays":[],"dots":[{"x":1,"y":1},{"x":1,"y":2},{"x":1,"y":3},{"x":1,"y":4},{"x":2,"y":1},{"x":2,"y":2},{"x":2,"y":3},{"x":2,"y":4},{"x":3,"y":1},{"x":3,"y":2},{"x":3,"y":3},{"x":3,"y":4},{"x":4,"y":1},{"x":4,"y":2},{"x":4,"y":3},{"x":4,"y":4}],"polygons":[{"dots":[{"x":3.5,"y":1.5},{"x":3.5,"y":-1},{"x":2.5,"y":-1},{"x":2.5,"y":1.5}]},{"dots":[{"x":3.5,"y":-1},{"x":3.5,"y":1.5},{"x":6.5,"y":1.5},{"x":6.5,"y":-1}]},{"dots":[{"x":3.5,"y":1.5},{"x":2.5,"y":1.5},{"x":2.5,"y":2.5},{"x":3.5,"y":2.5}]},{"dots":[{"x":6.5,"y":1.5},{"x":3.5,"y":1.5},{"x":3.5,"y":2.5},{"x":6.5,"y":2.5}]},{"dots":[{"x":3.5,"y":2.5},{"x":2.5,"y":2.5},{"x":2.5,"y":3.5},{"x":3.5,"y":3.5}]},{"dots":[{"x":6.5,"y":2.5},{"x":3.5,"y":2.5},{"x":3.5,"y":3.5},{"x":6.5,"y":3.5}]},{"dots":[{"x":3.5,"y":3.5},{"x":2.5,"y":3.5},{"x":2.5,"y":5},{"x":3.5,"y":5}]},{"dots":[{"x":6.5,"y":3.5},{"x":3.5,"y":3.5},{"x":3.5,"y":5},{"x":6.5,"y":5}]}]};
var camera = [[1,0,0],[0,1,0],[0,0,1]];
var coordToCamera = function(x,y){
	var c = camera;
	return {
		"x":c[0][0]*x+c[1][0]*y+c[2][0],
		"y":c[0][1]*x+c[1][1]*y+c[2][1]
	};
};
var polygonColors = ["#AA3333", "#33AA33", "#3333AA", "#AAAA33", "#AA33AA", "#33AAAA"]; 
var getRayMult = function(){
	return 1000/(Math.abs(camera[0][0])+Math.abs(camera[0][1])+Math.abs(camera[1][0])+Math.abs(camera[1][1]));
};
window.onload = function() {
	var drawingCanvas = document.getElementById('smile');
	var coord;
	if(drawingCanvas && drawingCanvas.getContext) {
		var context = drawingCanvas.getContext('2d');
		if(outputRepr.camera!==undefined){
			for(var i = 0; i < 3; i++){
				for(var j = 0; j < 3; j++){
					if(outputRepr.camera[i][j] !== undefined){
						camera[i][j] = outputRepr.camera[i][j];
					}
				}
			}
		}
		if(outputRepr.size!==undefined){
			drawingCanvas.width = outputRepr.size.x;
			drawingCanvas.height = outputRepr.size.y;
		}
		var rayMult = getRayMult();		
		
		if(outputRepr.polygons!==undefined){
			for(var polyId = 0; polyId < outputRepr.polygons.length; polyId++){
				var poly = outputRepr.polygons[polyId];
				context.fillStyle = polygonColors[polyId % polygonColors.length];
				context.shadowColor = "rgba(0,0,0,.5)";
				context.shadowBlur = 2;
				context.lineCap = 'round';
				context.lineJoin = 'round';
				context.lineWidth = 1;
				
				context.beginPath();
				coord = coordToCamera(poly.dots[0].x, poly.dots[0].y);
				context.moveTo(coord.x, coord.y);
				for(var dotId = 1; dotId < poly.dots.length; dotId++){
					coord = coordToCamera(poly.dots[dotId].x, poly.dots[dotId].y);
					context.lineTo(coord.x, coord.y);
				}
				context.closePath();
				context.fill();
			}
		}
		if(outputRepr.edges!==undefined){
			outputRepr.edges.forEach((elem)=>{
				context.shadowColor = "rgba(0,0,0,.5)";
				context.shadowBlur = 2;
				context.lineCap = 'round';
				context.lineJoin = 'round';
				context.lineWidth = 1;
				context.beginPath();
				coord = coordToCamera(elem.x1, elem.y1);
				context.moveTo(coord.x, coord.y);
				coord = coordToCamera(elem.x2, elem.y2);
				context.lineTo(coord.x, coord.y);				
				context.stroke();
			});
		}
		if(outputRepr.rays!==undefined){
			outputRepr.rays.forEach((elem)=>{
				context.shadowColor = "rgba(0,0,0,.5)";
				context.shadowBlur = 2;
				context.lineCap = 'round';
				context.lineJoin = 'round';
				context.lineWidth = 1;
				context.beginPath();
				coord = coordToCamera(elem.x, elem.y);
				context.moveTo(coord.x, coord.y);
				var rayCoord = coordToCamera(elem.x+elem.dx*rayMult, elem.y+elem.dy*rayMult);
				context.lineTo(rayCoord.x, rayCoord.y);
				context.lineCap = 'round';
				context.stroke();
			});
		}			
		if(outputRepr.dots!==undefined){
			outputRepr.dots.forEach((elem)=>{
				context.shadowColor = "rgba(0,0,0,.5)";
				context.fillStyle = "#FFF";
				context.shadowBlur = 2;
				context.lineCap = 'round';
				context.lineJoin = 'round';
				context.lineWidth = 1;
				coord = coordToCamera(elem.x, elem.y);
				context.beginPath();
				context.arc(coord.x, coord.y, 3, 0, Math.PI*2);
				context.fill();
			});
		}
	}
}
  </script>
 </head>
 <body>
  <canvas id="smile" width="200" height="200">
    <p>Ваш браузер не поддерживает рисование.</p>
  </canvas>
 </body>
</html>