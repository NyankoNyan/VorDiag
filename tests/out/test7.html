<!DOCTYPE html>
<html>
 <head>
  <title>canvas</title>
  <meta charset="utf-8">
  <script> 
var outputRepr = {"size":{"x":700,"y":700},"camera":[[0.5833333,0,0],[0,-0.5833333,0],[58.333332,641.6666,1]],"edges":[{"x1":605.528,"y1":148.77037,"x2":449.76468,"y2":-318.42712},{"x1":410.52457,"y1":-610.70264,"x2":310.8591,"y2":20.331863},{"x1":410.52457,"y1":-610.70264,"x2":449.76468,"y2":-318.42712},{"x1":449.76468,"y1":-318.42712,"x2":468.12128,"y2":47.098335},{"x1":1906.1959,"y1":-4701.1997,"x2":715.51917,"y2":77.251434},{"x1":310.8591,"y1":20.331863,"x2":206.53337,"y2":165.51947},{"x1":310.8591,"y1":20.331863,"x2":333.9296,"y2":202.60562},{"x1":1906.1959,"y1":-4701.1997,"x2":831.5242,"y2":186.92339},{"x1":468.12128,"y1":47.098335,"x2":390.0796,"y2":224.24535},{"x1":715.51917,"y1":77.251434,"x2":648.2328,"y2":153.05832},{"x1":468.12128,"y1":47.098335,"x2":500.84872,"y2":126.680244},{"x1":715.51917,"y1":77.251434,"x2":760.2721,"y2":206.55742},{"x1":567.5807,"y1":179.82977,"x2":500.84872,"y2":126.680244},{"x1":500.84872,"y1":126.680244,"x2":477.96616,"y2":196.83891},{"x1":161.11797,"y1":141.53497,"x2":79.30332,"y2":216.98442},{"x1":161.11797,"y1":141.53497,"x2":192.72221,"y2":164.10846},{"x1":648.2328,"y1":153.05832,"x2":605.528,"y2":148.77037},{"x1":605.528,"y1":148.77037,"x2":567.5807,"y2":179.82977},{"x1":648.2328,"y1":153.05832,"x2":659.13074,"y2":178.75069},{"x1":750.4177,"y1":218.70224,"x2":659.13074,"y2":178.75069},{"x1":659.13074,"y1":178.75069,"x2":628.90454,"y2":272.88873},{"x1":192.72221,"y1":164.10846,"x2":153.66235,"y2":229.11848},{"x1":192.72221,"y1":164.10846,"x2":206.53337,"y2":165.51947},{"x1":206.53337,"y1":165.51947,"x2":265.63763,"y2":223.07951},{"x1":557.5708,"y1":239.15959,"x2":477.96616,"y2":196.83891},{"x1":477.96616,"y1":196.83891,"x2":401.16193,"y2":225.87863},{"x1":567.5807,"y1":179.82977,"x2":557.5708,"y2":239.15959},{"x1":831.5242,"y1":186.92339,"x2":760.2721,"y2":206.55742},{"x1":831.5242,"y1":186.92339,"x2":885.7894,"y2":238.40968},{"x1":153.66235,"y1":229.11848,"x2":79.30332,"y2":216.98442},{"x1":153.66235,"y1":229.11848,"x2":200.65677,"y2":316.28076},{"x1":760.2721,"y1":206.55742,"x2":750.4177,"y2":218.70224},{"x1":79.30332,"y1":216.98442,"x2":57.04496,"y2":221.89743},{"x1":333.9296,"y1":202.60562,"x2":265.63763,"y2":223.07951},{"x1":188.37773,"y1":334.87436,"x2":57.04496,"y2":221.89743},{"x1":333.9296,"y1":202.60562,"x2":339.87213,"y2":205.76106},{"x1":885.7894,"y1":238.40968,"x2":787.1129,"y2":290.88562},{"x1":750.4177,"y1":218.70224,"x2":745.7899,"y2":236.26501},{"x1":339.87213,"y1":205.76106,"x2":320.94482,"y2":275.68915},{"x1":339.87213,"y1":205.76106,"x2":390.0796,"y2":224.24535},{"x1":320.94482,"y1":275.68915,"x2":293.08234,"y2":321.83456},{"x1":320.94482,"y1":275.68915,"x2":332.5371,"y2":338.04312},{"x1":475.8581,"y1":268.32135,"x2":401.16193,"y2":225.87863},{"x1":265.63763,"y1":223.07951,"x2":225.32187,"y2":299.6228},{"x1":563.3124,"y1":263.04654,"x2":475.8581,"y2":268.32135},{"x1":475.8581,"y1":268.32135,"x2":468.0328,"y2":305.37238},{"x1":745.7899,"y1":236.26501,"x2":666.6796,"y2":297.79047},{"x1":745.7899,"y1":236.26501,"x2":787.1129,"y2":290.88562},{"x1":468.0328,"y1":305.37238,"x2":399.51843,"y2":288.44498},{"x1":401.16193,"y1":225.87863,"x2":390.95383,"y2":225.14963},{"x1":557.5708,"y1":239.15959,"x2":563.3124,"y2":263.04654},{"x1":885.7894,"y1":238.40968,"x2":1081.6238,"y2":342.89136},{"x1":390.0796,"y1":224.24535,"x2":390.95383,"y2":225.14963},{"x1":390.95383,"y1":225.14963,"x2":389.88556,"y2":271.7843},{"x1":468.0328,"y1":305.37238,"x2":471.66614,"y2":339.16223},{"x1":787.1129,"y1":290.88562,"x2":798.3742,"y2":353.53195},{"x1":389.88556,"y1":271.7843,"x2":332.5371,"y2":338.04312},{"x1":389.88556,"y1":271.7843,"x2":399.51843,"y2":288.44498},{"x1":399.51843,"y1":288.44498,"x2":427.77982,"y2":356.31793},{"x1":628.90454,"y1":272.88873,"x2":563.651,"y2":263.48032},{"x1":628.90454,"y1":272.88873,"x2":666.6796,"y2":297.79047},{"x1":563.3124,"y1":263.04654,"x2":563.651,"y2":263.48032},{"x1":563.651,"y1":263.48032,"x2":537.659,"y2":340.5471},{"x1":293.08234,"y1":321.83456,"x2":225.32187,"y2":299.6228},{"x1":293.08234,"y1":321.83456,"x2":329.50616,"y2":342.37778},{"x1":666.6796,"y1":297.79047,"x2":686.64856,"y2":383.10464},{"x1":509.74222,"y1":345.9141,"x2":471.66614,"y2":339.16223},{"x1":471.66614,"y1":339.16223,"x2":427.77982,"y2":356.31793},{"x1":225.32187,"y1":299.6228,"x2":200.65677,"y2":316.28076},{"x1":332.5371,"y1":338.04312,"x2":329.50616,"y2":342.37778},{"x1":329.50616,"y1":342.37778,"x2":346.34232,"y2":410.49164},{"x1":509.74222,"y1":345.9141,"x2":475.85547,"y2":419.83838},{"x1":509.74222,"y1":345.9141,"x2":537.659,"y2":340.5471},{"x1":537.659,"y1":340.5471,"x2":587.778,"y2":426.1001},{"x1":200.65677,"y1":316.28076,"x2":188.37773,"y2":334.87436},{"x1":427.77982,"y1":356.31793,"x2":412.08817,"y2":390.12756},{"x1":1081.6238,"y1":342.89136,"x2":798.3742,"y2":353.53195},{"x1":798.3742,"y1":353.53195,"x2":759.4043,"y2":385.88065},{"x1":188.37773,"y1":334.87436,"x2":177.06848,"y2":363.2099},{"x1":346.34232,"y1":410.49164,"x2":199.6673,"y2":392.43167},{"x1":470.05612,"y1":419.8759,"x2":412.08817,"y2":390.12756},{"x1":412.08817,"y1":390.12756,"x2":356.42844,"y2":420.398},{"x1":475.85547,"y1":419.83838,"x2":470.05612,"y2":419.8759},{"x1":475.85547,"y1":419.83838,"x2":556.40704,"y2":457.42834},{"x1":470.05612,"y1":419.8759,"x2":440.3965,"y2":504.40475},{"x1":177.06848,"y1":363.2099,"x2":-204.6424,"y2":456.38098},{"x1":759.4043,"y1":385.88065,"x2":686.64856,"y2":383.10464},{"x1":759.4043,"y1":385.88065,"x2":809.79877,"y2":481.9164},{"x1":177.06848,"y1":363.2099,"x2":199.6673,"y2":392.43167},{"x1":754.905,"y1":521.812,"x2":686.40607,"y2":383.3755},{"x1":744.134,"y1":533.388,"x2":678.7879,"y2":390.11038},{"x1":686.64856,"y1":383.10464,"x2":686.40607,"y2":383.3755},{"x1":686.40607,"y1":383.3755,"x2":678.7879,"y2":390.11038},{"x1":199.6673,"y1":392.43167,"x2":203.33339,"y2":416.45718},{"x1":678.7879,"y1":390.11038,"x2":644.809,"y2":419.2013},{"x1":302.2588,"y1":515.6378,"x2":203.33339,"y2":416.45718},{"x1":190.17076,"y1":469.80893,"x2":-25.374706,"y2":503.75885},{"x1":203.33339,"y1":416.45718,"x2":190.17076,"y2":469.80893},{"x1":346.34232,"y1":410.49164,"x2":356.42844,"y2":420.398},{"x1":644.809,"y1":419.2013,"x2":587.778,"y2":426.1001},{"x1":356.42844,"y1":420.398,"x2":355.42636,"y2":479.97406},{"x1":644.809,"y1":419.2013,"x2":681.2882,"y2":532.8972},{"x1":587.778,"y1":426.1001,"x2":556.40704,"y2":457.42834},{"x1":190.17076,"y1":469.80893,"x2":192.72581,"y2":519.51953},{"x1":556.40704,"y1":457.42834,"x2":532.66907,"y2":529.7055},{"x1":299.3,"y1":518.23145,"x2":192.72581,"y2":519.51953},{"x1":809.79877,"y1":481.9164,"x2":754.905,"y2":521.812},{"x1":809.79877,"y1":481.9164,"x2":842.3845,"y2":489.3176},{"x1":433.17282,"y1":503.99942,"x2":355.42636,"y2":479.97406},{"x1":1255.645,"y1":386.32394,"x2":842.3845,"y2":489.3176},{"x1":440.3965,"y1":504.40475,"x2":433.17282,"y2":503.99942},{"x1":433.17282,"y1":503.99942,"x2":418.14926,"y2":568.9343},{"x1":440.3965,"y1":504.40475,"x2":521.1737,"y2":537.84064},{"x1":842.3845,"y1":489.3176,"x2":836.81494,"y2":574.1089},{"x1":355.42636,"y1":479.97406,"x2":336.5182,"y2":503.33847},{"x1":192.72581,"y1":519.51953,"x2":156.05614,"y2":565.9617},{"x1":754.905,"y1":521.812,"x2":744.134,"y2":533.388},{"x1":486.3979,"y1":599.70526,"x2":418.14926,"y2":568.9343},{"x1":418.14926,"y1":568.9343,"x2":374.1625,"y2":590.24677},{"x1":336.5182,"y1":503.33847,"x2":302.2588,"y2":515.6378},{"x1":336.5182,"y1":503.33847,"x2":373.0634,"y2":590.2703},{"x1":2034.9044,"y1":438.65707,"x2":844.9821,"y2":578.9418},{"x1":302.2588,"y1":515.6378,"x2":299.3,"y2":518.23145},{"x1":299.3,"y1":518.23145,"x2":266.24237,"y2":600.93317},{"x1":744.134,"y1":533.388,"x2":731.47534,"y2":547.65094},{"x1":1081.6238,"y1":342.89136,"x2":1255.645,"y2":386.32394},{"x1":681.2882,"y1":532.8972,"x2":627.44385,"y2":568.1716},{"x1":681.2882,"y1":532.8972,"x2":731.47534,"y2":547.65094},{"x1":627.44385,"y1":568.1716,"x2":532.66907,"y2":529.7055},{"x1":844.9821,"y1":578.9418,"x2":836.81494,"y2":574.1089},{"x1":836.81494,"y1":574.1089,"x2":786.22723,"y2":605.3048},{"x1":844.9821,"y1":578.9418,"x2":867.3768,"y2":619.54675},{"x1":867.3768,"y1":619.54675,"x2":786.22723,"y2":605.3048},{"x1":532.66907,"y1":529.7055,"x2":521.1737,"y2":537.84064},{"x1":731.47534,"y1":547.65094,"x2":754.05164,"y2":609.23254},{"x1":156.05614,"y1":565.9617,"x2":-25.374706,"y2":503.75885},{"x1":439.12833,"y1":613.75385,"x2":374.1625,"y2":590.24677},{"x1":521.1737,"y1":537.84064,"x2":502.50964,"y2":597.32477},{"x1":627.44385,"y1":568.1716,"x2":632.13324,"y2":636.32794},{"x1":374.1625,"y1":590.24677,"x2":373.0634,"y2":590.2703},{"x1":373.0634,"y1":590.2703,"x2":356.6707,"y2":630.7843},{"x1":156.05614,"y1":565.9617,"x2":203.26357,"y2":651.99713},{"x1":356.6707,"y1":630.7843,"x2":266.24237,"y2":600.93317},{"x1":486.3979,"y1":599.70526,"x2":439.12833,"y2":613.75385},{"x1":439.12833,"y1":613.75385,"x2":395.63596,"y2":677.65314},{"x1":867.3768,"y1":619.54675,"x2":905.1315,"y2":675.94165},{"x1":266.24237,"y1":600.93317,"x2":203.26357,"y2":651.99713},{"x1":786.22723,"y1":605.3048,"x2":777.7173,"y2":610.0403},{"x1":486.3979,"y1":599.70526,"x2":500.60983,"y2":598.65796},{"x1":871.3643,"y1":682.07587,"x2":777.7173,"y2":610.0403},{"x1":777.7173,"y1":610.0403,"x2":754.05164,"y2":609.23254},{"x1":591.25073,"y1":683.9153,"x2":502.50964,"y2":597.32477},{"x1":502.50964,"y1":597.32477,"x2":500.60983,"y2":598.65796},{"x1":500.60983,"y1":598.65796,"x2":456.5401,"y2":712.7976},{"x1":-25.374706,"y1":503.75885,"x2":-204.6424,"y2":456.38098},{"x1":356.6707,"y1":630.7843,"x2":364.20703,"y2":670.37964},{"x1":754.05164,"y1":609.23254,"x2":731.58563,"y2":648.84564},{"x1":731.58563,"y1":648.84564,"x2":632.13324,"y2":636.32794},{"x1":632.13324,"y1":636.32794,"x2":591.25073,"y2":683.9153},{"x1":357.42148,"y1":676.4648,"x2":275.92856,"y2":678.6674},{"x1":731.58563,"y1":648.84564,"x2":734.39874,"y2":671.5087},{"x1":330.48685,"y1":781.3388,"x2":275.92856,"y2":678.6674},{"x1":275.92856,"y1":678.6674,"x2":207.06522,"y2":661.15485},{"x1":723.8684,"y1":691.7954,"x2":600.2915,"y2":726.4136},{"x1":395.63596,"y1":677.65314,"x2":364.20703,"y2":670.37964},{"x1":817.5221,"y1":721.7613,"x2":734.39874,"y2":671.5087},{"x1":395.63596,"y1":677.65314,"x2":447.30182,"y2":711.6312},{"x1":364.20703,"y1":670.37964,"x2":357.42148,"y2":676.4648},{"x1":357.42148,"y1":676.4648,"x2":330.48685,"y2":781.3388},{"x1":734.39874,"y1":671.5087,"x2":723.8684,"y2":691.7954},{"x1":723.8684,"y1":691.7954,"x2":720.9398,"y2":739.96375},{"x1":871.3643,"y1":682.07587,"x2":817.5221,"y2":721.7613},{"x1":871.3643,"y1":682.07587,"x2":905.1315,"y2":675.94165},{"x1":203.26357,"y1":651.99713,"x2":203.23682,"y2":652.2602},{"x1":203.23682,"y1":652.2602,"x2":207.06522,"y2":661.15485},{"x1":811.7151,"y1":748.08154,"x2":720.9398,"y2":739.96375},{"x1":207.06522,"y1":661.15485,"x2":206.2434,"y2":716.6024},{"x1":591.25073,"y1":683.9153,"x2":589.00995,"y2":719.5393},{"x1":447.30182,"y1":711.6312,"x2":335.93176,"y2":817.1494},{"x1":447.30182,"y1":711.6312,"x2":456.5401,"y2":712.7976},{"x1":817.5221,"y1":721.7613,"x2":811.7151,"y2":748.08154},{"x1":720.9398,"y1":739.96375,"x2":704.37756,"y2":785.05237},{"x1":456.5401,"y1":712.7976,"x2":501.08536,"y2":752.7432},{"x1":206.2434,"y1":716.6024,"x2":225.96776,"y2":770.9387},{"x1":811.7151,"y1":748.08154,"x2":811.75604,"y2":751.9061},{"x1":811.75604,"y1":751.9061,"x2":778.00775,"y2":809.0432},{"x1":1255.645,"y1":386.32394,"x2":2034.9044,"y2":438.65707},{"x1":600.2915,"y1":726.4136,"x2":589.00995,"y2":719.5393},{"x1":589.00995,"y1":719.5393,"x2":534.06067,"y2":752.7692},{"x1":600.2915,"y1":726.4136,"x2":627.8782,"y2":756.26587},{"x1":627.8782,"y1":756.26587,"x2":598.3921,"y2":836.10815},{"x1":627.8782,"y1":756.26587,"x2":675.051,"y2":788.37274},{"x1":534.06067,"y1":752.7692,"x2":501.08536,"y2":752.7432},{"x1":501.08536,"y1":752.7432,"x2":481.05984,"y2":783.6615},{"x1":534.06067,"y1":752.7692,"x2":566.22754,"y2":861.29095},{"x1":554.91595,"y1":942.5726,"x2":481.05984,"y2":783.6615},{"x1":481.05984,"y1":783.6615,"x2":436.1396,"y2":833.3601},{"x1":704.37756,"y1":785.05237,"x2":675.051,"y2":788.37274},{"x1":660.1739,"y1":825.72784,"x2":598.3921,"y2":836.10815},{"x1":225.96776,"y1":770.9387,"x2":317.50656,"y2":825.7332},{"x1":704.37756,"y1":785.05237,"x2":742.44305,"y2":811.7649},{"x1":675.051,"y1":788.37274,"x2":660.1739,"y2":825.72784},{"x1":330.48685,"y1":781.3388,"x2":327.50272,"y2":818.34064},{"x1":778.00775,"y1":809.0432,"x2":742.44305,"y2":811.7649},{"x1":598.3921,"y1":836.10815,"x2":566.22754,"y2":861.29095},{"x1":660.1739,"y1":825.72784,"x2":660.3996,"y2":1143.7815},{"x1":742.44305,"y1":811.7649,"x2":660.3996,"y2":1143.7815},{"x1":436.1396,"y1":833.3601,"x2":335.93176,"y2":817.1494},{"x1":436.1396,"y1":833.3601,"x2":548.405,"y2":1049.8978},{"x1":335.93176,"y1":817.1494,"x2":327.50272,"y2":818.34064},{"x1":566.22754,"y1":861.29095,"x2":554.91595,"y2":942.5726},{"x1":327.50272,"y1":818.34064,"x2":317.50656,"y2":825.7332},{"x1":554.91595,"y1":942.5726,"x2":548.405,"y2":1049.8978},{"x1":548.405,"y1":1049.8978,"x2":621.17004,"y2":1456.2947},{"x1":660.3996,"y1":1143.7815,"x2":621.17004,"y2":1456.2947}],"rays":[{"x":410.52457,"y":-610.70264,"dx":-3.6218948,"dy":-425.89508},{"x":161.11797,"y":141.53497,"dx":-54.106323,"dy":-96.33562},{"x":1906.1959,"y":-4701.1997,"dx":63.510063,"dy":-268.75446},{"x":57.04496,"y":221.89743,"dx":-129.38048,"dy":-3.5615692},{"x":203.23682,"y":652.2602,"dx":-97.54309,"dy":22.270409},{"x":905.1315,"y":675.94165,"dx":161.71631,"dy":11.718506},{"x":206.2434,"y":716.6024,"dx":-51.661438,"dy":22.994217},{"x":811.75604,"y":751.9061,"dx":45.12561,"dy":30.146362},{"x":-204.6424,"y":456.38098,"dx":-335.57224,"dy":0.7309952},{"x":225.96776,"y":770.9387,"dx":-73.23627,"dy":62.477448},{"x":778.00775,"y":809.0432,"dx":65.531006,"dy":66.108826},{"x":317.50656,"y":825.7332,"dx":-40.309143,"dy":193.78577},{"x":2034.9044,"y":438.65707,"dx":428.21158,"dy":22.468323},{"x":621.17004,"y":1456.2947,"dx":21.336304,"dy":361.8459}],"dots":[{"x":191.35062,"y":224.75706},{"x":440.4566,"y":447.602},{"x":496.72534,"y":839.20984},{"x":875.8245,"y":592.5352},{"x":871.8177,"y":558.54846},{"x":840.02386,"y":612.2802},{"x":271.5329,"y":444.7607},{"x":864.106,"y":754.2515},{"x":761.5917,"y":731.63367},{"x":323.6294,"y":589.87354},{"x":475.32233,"y":379.66226},{"x":839.18414,"y":617.0649},{"x":835.8855,"y":414.37112},{"x":812.46234,"y":254.78683},{"x":898.29285,"y":164.32364},{"x":739.3935,"y":465.00488},{"x":406.00494,"y":886.24445},{"x":831.2152,"y":290.05005},{"x":446.8862,"y":306.91983},{"x":129.30681,"y":258.20862},{"x":305.76703,"y":643.9841},{"x":680.1931,"y":599.5465},{"x":513.42163,"y":831.45},{"x":232.29073,"y":553.3635},{"x":767.8508,"y":864.90814},{"x":579.4887,"y":606.4752},{"x":619.5243,"y":200.54324},{"x":307.597,"y":711.68835},{"x":285.57294,"y":723.39166},{"x":511.71652,"y":182.35422},{"x":126.74751,"y":721.0376},{"x":594.2424,"y":807.494},{"x":719.1549,"y":475.019},{"x":306.27527,"y":285.28848},{"x":513.54553,"y":674.056},{"x":407.36536,"y":554.6719},{"x":702.32684,"y":165.42076},{"x":384.10654,"y":731.3382},{"x":599.4692,"y":339.63763},{"x":203.6433,"y":104.43547},{"x":282.08038,"y":359.09882},{"x":386.93604,"y":133.38469},{"x":484.8349,"y":232.9183},{"x":745.4806,"y":305.4617},{"x":678.64746,"y":219.52684},{"x":104.477104,"y":623.4945},{"x":695.2033,"y":846.9526},{"x":231.46112,"y":484.72937},{"x":149.74173,"y":772.69904},{"x":780.3916,"y":138.40262},{"x":625.17474,"y":847.00226},{"x":139.818,"y":193.7948},{"x":557.5428,"y":124.81687},{"x":804.1484,"y":554.1035},{"x":716.4367,"y":476.25873},{"x":212.21918,"y":845.9353},{"x":619.7484,"y":507.28107},{"x":800.2738,"y":667.6487},{"x":434.10162,"y":560.85767},{"x":422.65912,"y":586.2366},{"x":629.5384,"y":100.813576},{"x":506.641,"y":394.01868},{"x":669.5789,"y":683.87085},{"x":759.4685,"y":755.37427},{"x":833.95966,"y":799.37714},{"x":681.5965,"y":726.77014},{"x":459.246,"y":165.24066},{"x":379.26074,"y":335.07812},{"x":319.28082,"y":293.1412},{"x":475.84192,"y":460.01804},{"x":328.76996,"y":291.37708},{"x":489.02496,"y":302.38873},{"x":107.30768,"y":158.5418},{"x":103.74611,"y":287.92227},{"x":146.67879,"y":463.8124},{"x":150.62775,"y":488.88406},{"x":450.03992,"y":294.15503},{"x":408.8642,"y":624.3612},{"x":440.36124,"y":645.7993},{"x":424.21588,"y":773.67194},{"x":265.34833,"y":148.77412},{"x":620.1439,"y":817.0596}],"polygons":[],"arcs":[],"circles":[],"lines":[]};
var camera = [[1,0,0],[0,1,0],[0,0,1]];
var reverseCamera;

var matrixMult = function(x,y,m){
	return {
		"x":m[0][0]*x+m[1][0]*y+m[2][0],
		"y":m[0][1]*x+m[1][1]*y+m[2][1]
	};
};
var coordToCamera = function(x,y){
	return matrixMult(x,y,camera);
};
var scaleCoord = function(x,y){
	var c = camera;
	return {
		"x":c[0][0]*x+c[1][0]*y,
		"y":c[0][1]*x+c[1][1]*y
	};
}
var polygonColors = ["#CD5C5C", "#ADFF2F", "#7B68EE", "#FFA500",
"#F08080", "#00FF00", "#4682B4", "#A52A2A",
"#E9967A", "#32CD32", "#87CEFA", "#D2691E",
"#DC143C", "#00FA9A", "#4169E1",
"#B22222", "#9ACD32", "#FFD700",
"#FF69B4", "#808000", "#FFDAB9",
"#C71585", "#66CDAA", "#F0E68C",
"#DB7093", "#008B8B", "#9370DB"]; 
var getRayMult = function(){
	return 1000/(Math.abs(camera[0][0])+Math.abs(camera[0][1])+Math.abs(camera[1][0])+Math.abs(camera[1][1]));
};

var getMinor = function(m, x, y){
	var x1 = (x+1)%3;
	var x2 = (x+2)%3;
	var y1 = (y+1)%3;
	var y2 = (y+2)%3;
	return m[x1][y1]*m[x2][y2] - m[x1][y2]*m[x2][y1];
};
var getMinorMatrix = function(m){
	var result = [];
	for(var i = 0; i < 3; i++){
		result[i] = [];
		for(var j = 0; j < 3; j++){
			result[i][j] = getMinor(m, i, j);
		}
	}
	return result;
};
var backMatrix = function(m){	
	var mmin = getMinorMatrix(m);	
	var det = m[0][0] * mmin[0][0] - m[0][1] * mmin[0][1] + m[0][2] * mmin[0][2];	
	var result = [];
	for(var i = 0; i < 3; i++){
		result[i] = [];
		for(var j = 0; j < 3; j++){
			result[i][j] = mmin[j][i] / det * ((i+j)%2==0?1:-1);
		}
	}
	return result;		
};
window.onload = function() {
	var drawingCanvas = document.getElementById('smile');
	var coord;
	if(drawingCanvas && drawingCanvas.getContext) {
		var context = drawingCanvas.getContext('2d');
		if(outputRepr.camera!==undefined){
			for(var i = 0; i < 3; i++){
				for(var j = 0; j < 3; j++){
					if(outputRepr.camera[i][j] !== undefined){
						camera[i][j] = outputRepr.camera[i][j];
					}
				}
			}
		}
		reverseCamera = backMatrix(camera);
		if(outputRepr.size!==undefined){
			drawingCanvas.width = outputRepr.size.x;
			drawingCanvas.height = outputRepr.size.y;
		}
		var rayMult = getRayMult();		
		var minCorner = matrixMult(0, 0, reverseCamera);
		var maxCorner = matrixMult(drawingCanvas.width, drawingCanvas.height, reverseCamera);
		var xMin = Math.min(minCorner.x, maxCorner.x);
		var xMax = Math.max(minCorner.x, maxCorner.x);
		var xStep = (xMax - xMin) / drawingCanvas.width;
		var yMin = Math.min(minCorner.y, maxCorner.y);
		var yMax = Math.max(minCorner.y, maxCorner.y);
		
		context.shadowColor = "rgba(0,0,0,.5)";
		context.shadowBlur = 2;
		context.lineCap = 'round';
		context.lineJoin = 'round';
		context.lineWidth = 1;
		
		if(outputRepr.polygons!==undefined){
			for(var polyId = 0; polyId < outputRepr.polygons.length; polyId++){
				var poly = outputRepr.polygons[polyId];
				context.fillStyle = polygonColors[polyId % polygonColors.length];				
				
				context.beginPath();
				coord = coordToCamera(poly.dots[0].x, poly.dots[0].y);
				context.moveTo(coord.x, coord.y);
				for(var dotId = 1; dotId < poly.dots.length; dotId++){
					coord = coordToCamera(poly.dots[dotId].x, poly.dots[dotId].y);
					context.lineTo(coord.x, coord.y);
				}
				context.closePath();
				context.fill();
			}
		}
		if(outputRepr.edges!==undefined){
			context.strokeStyle = "#AA0";
			
			outputRepr.edges.forEach((elem)=>{				
				context.beginPath();
				coord = coordToCamera(elem.x1, elem.y1);
				context.moveTo(coord.x, coord.y);
				coord = coordToCamera(elem.x2, elem.y2);
				context.lineTo(coord.x, coord.y);				
				context.stroke();
			});
		}
		if(outputRepr.rays!==undefined){
			context.strokeStyle = "#0AA";
			
			outputRepr.rays.forEach((elem)=>{				
				context.beginPath();
				coord = coordToCamera(elem.x, elem.y);
				context.moveTo(coord.x, coord.y);
				var rayCoord = coordToCamera(elem.x+elem.dx*rayMult, elem.y+elem.dy*rayMult);
				context.lineTo(rayCoord.x, rayCoord.y);
				context.lineCap = 'round';
				context.stroke();
			});
		}	
		if(outputRepr.lines!==undefined){
			context.strokeStyle = "#AAA";
			
			outputRepr.lines.forEach((elem)=>{
				var x, y;
				var coord1, coord2;
				if(Math.abs(elem.dx) > Math.abs(elem.dy)){
					coord1 = coordToCamera((-elem.dy * yMin - elem.c) / elem.dx, yMin);
					coord2 = coordToCamera((-elem.dy * yMax - elem.c) / elem.dx, yMax);
				}else{
					coord1 = coordToCamera(xMin, (-elem.dx * xMin - elem.c) / elem.dy);
					coord2 = coordToCamera(xMax, (-elem.dx * xMax - elem.c) / elem.dy);
				}
				context.beginPath();
				context.moveTo(coord1.x, coord1.y);
				context.lineTo(coord2.x, coord2.y);
				context.stroke();
			});
		}
		if(outputRepr.circles!==undefined){
			context.setLineDash([5,5]);
			context.strokeStyle = "#A00";
			
			outputRepr.circles.forEach((elem)=>{
				var coord = coordToCamera(elem.x, elem.y);
				var size = scaleCoord(1, 1);
				context.beginPath();
				context.ellipse(coord.x, coord.y, elem.r*Math.abs(size.x), elem.r*Math.abs(size.y), 0, 0, Math.PI*2);
				context.stroke();
			});
			context.setLineDash([]);
		}
		if(outputRepr.arcs!==undefined){
			context.strokeStyle = "#00A";

			outputRepr.arcs.forEach((elem)=>{
				context.beginPath();
				drawMinX = Math.max(elem.minX, xMin);
				drawMaxX = Math.min(elem.maxX, xMax);
				var count = 0;
				for(var x = drawMinX; x < drawMaxX+xStep; x += xStep){
					var y = .5 * ((x - elem.fX) * (x - elem.fX) 
						+ elem.fY * elem.fY - elem.dirY * elem.dirY)
						/ (elem.fY - elem.dirY);
					var coord = coordToCamera(x,y);
					if(count==0){
						context.moveTo(coord.x, coord.y);
					}else{
						context.lineTo(coord.x, coord.y);
					}
					count++;
				}
				//context.closePath();
				context.stroke();
			});
		}
		if(outputRepr.dots!==undefined){
			context.fillStyle = "#FFF";
			context.strokeStyle = "#000";
			
			outputRepr.dots.forEach((elem)=>{				
				coord = coordToCamera(elem.x, elem.y);
				context.beginPath();
				context.arc(coord.x, coord.y, 3, 0, Math.PI*2);
				context.fill();
				context.stroke();				
			});
		}
	}
}
  </script>
 </head>
 <body>
  <canvas id="smile" width="200" height="200">
    <p>Ваш браузер не поддерживает рисование.</p>
  </canvas>
 </body>
</html>