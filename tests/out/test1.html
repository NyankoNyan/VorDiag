<!DOCTYPE html>
<html>
 <head>
  <title>canvas</title>
  <meta charset="utf-8">
  <script> 
var outputRepr = {"size":{"x":700,"y":700},"camera":[[1.1666666,0,0],[0,-1.1666666,0],[58.333332,641.6666,1]],"edges":[],"rays":[],"dots":[{"x":100,"y":100},{"x":100,"y":200},{"x":100,"y":300},{"x":200,"y":150},{"x":200,"y":250},{"x":200,"y":350},{"x":300,"y":120},{"x":300,"y":220},{"x":300,"y":320}],"polygons":[{"dots":[{"x":210.625,"y":3.75},{"x":211,"y":0},{"x":0,"y":0},{"x":0,"y":150},{"x":137.5,"y":150}]},{"dots":[{"x":211,"y":0},{"x":210.625,"y":3.75},{"x":260.5,"y":170},{"x":500,"y":170},{"x":500,"y":0}]},{"dots":[{"x":210.625,"y":3.75},{"x":137.5,"y":150},{"x":162.5,"y":200},{"x":239.5,"y":200},{"x":260.5,"y":170}]},{"dots":[{"x":137.5,"y":150},{"x":0,"y":150},{"x":0,"y":250},{"x":137.5,"y":250},{"x":162.5,"y":200}]},{"dots":[{"x":500,"y":170},{"x":260.5,"y":170},{"x":239.5,"y":200},{"x":260.5,"y":270},{"x":500,"y":270}]},{"dots":[{"x":239.5,"y":200},{"x":162.5,"y":200},{"x":137.5,"y":250},{"x":162.5,"y":300},{"x":239.5,"y":300},{"x":260.5,"y":270}]},{"dots":[{"x":137.5,"y":250},{"x":0,"y":250},{"x":0,"y":500},{"x":62.5,"y":500},{"x":162.5,"y":300}]},{"dots":[{"x":500,"y":270},{"x":260.5,"y":270},{"x":239.5,"y":300},{"x":299.5,"y":500},{"x":500,"y":500}]},{"dots":[{"x":239.5,"y":300},{"x":162.5,"y":300},{"x":62.5,"y":500},{"x":299.5,"y":500}]}]};
var camera = [[1,0,0],[0,1,0],[0,0,1]];
var coordToCamera = function(x,y){
	var c = camera;
	return {
		"x":c[0][0]*x+c[1][0]*y+c[2][0],
		"y":c[0][1]*x+c[1][1]*y+c[2][1]
	};
};
var polygonColors = ["#AA3333", "#33AA33", "#3333AA", "#AAAA33", "#AA33AA", "#33AAAA"]; 
var getRayMult = function(){
	return 1000/(Math.abs(camera[0][0])+Math.abs(camera[0][1])+Math.abs(camera[1][0])+Math.abs(camera[1][1]));
};
window.onload = function() {
	var drawingCanvas = document.getElementById('smile');
	var coord;
	if(drawingCanvas && drawingCanvas.getContext) {
		var context = drawingCanvas.getContext('2d');
		if(outputRepr.camera!==undefined){
			for(var i = 0; i < 3; i++){
				for(var j = 0; j < 3; j++){
					if(outputRepr.camera[i][j] !== undefined){
						camera[i][j] = outputRepr.camera[i][j];
					}
				}
			}
		}
		if(outputRepr.size!==undefined){
			drawingCanvas.width = outputRepr.size.x;
			drawingCanvas.height = outputRepr.size.y;
		}
		var rayMult = getRayMult();		
		
		if(outputRepr.polygons!==undefined){
			for(var polyId = 0; polyId < outputRepr.polygons.length; polyId++){
				var poly = outputRepr.polygons[polyId];
				context.fillStyle = polygonColors[polyId % polygonColors.length];
				context.shadowColor = "rgba(0,0,0,.5)";
				context.shadowBlur = 2;
				context.lineCap = 'round';
				context.lineJoin = 'round';
				context.lineWidth = 1;
				
				context.beginPath();
				coord = coordToCamera(poly.dots[0].x, poly.dots[0].y);
				context.moveTo(coord.x, coord.y);
				for(var dotId = 1; dotId < poly.dots.length; dotId++){
					coord = coordToCamera(poly.dots[dotId].x, poly.dots[dotId].y);
					context.lineTo(coord.x, coord.y);
				}
				context.closePath();
				context.fill();
			}
		}
		if(outputRepr.edges!==undefined){
			outputRepr.edges.forEach((elem)=>{
				context.shadowColor = "rgba(0,0,0,.5)";
				context.shadowBlur = 2;
				context.lineCap = 'round';
				context.lineJoin = 'round';
				context.lineWidth = 1;
				context.beginPath();
				coord = coordToCamera(elem.x1, elem.y1);
				context.moveTo(coord.x, coord.y);
				coord = coordToCamera(elem.x2, elem.y2);
				context.lineTo(coord.x, coord.y);				
				context.stroke();
			});
		}
		if(outputRepr.rays!==undefined){
			outputRepr.rays.forEach((elem)=>{
				context.shadowColor = "rgba(0,0,0,.5)";
				context.shadowBlur = 2;
				context.lineCap = 'round';
				context.lineJoin = 'round';
				context.lineWidth = 1;
				context.beginPath();
				coord = coordToCamera(elem.x, elem.y);
				context.moveTo(coord.x, coord.y);
				var rayCoord = coordToCamera(elem.x+elem.dx*rayMult, elem.y+elem.dy*rayMult);
				context.lineTo(rayCoord.x, rayCoord.y);
				context.lineCap = 'round';
				context.stroke();
			});
		}			
		if(outputRepr.dots!==undefined){
			outputRepr.dots.forEach((elem)=>{
				context.shadowColor = "rgba(0,0,0,.5)";
				context.fillStyle = "#FFF";
				context.shadowBlur = 2;
				context.lineCap = 'round';
				context.lineJoin = 'round';
				context.lineWidth = 1;
				coord = coordToCamera(elem.x, elem.y);
				context.beginPath();
				context.arc(coord.x, coord.y, 3, 0, Math.PI*2);
				context.fill();
			});
		}
	}
}
  </script>
 </head>
 <body>
  <canvas id="smile" width="200" height="200">
    <p>Ваш браузер не поддерживает рисование.</p>
  </canvas>
 </body>
</html>