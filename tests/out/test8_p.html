<!DOCTYPE html>
<html>
 <head>
  <title>canvas</title>
  <meta charset="utf-8">
  <script> 
var outputRepr = {"size":{"x":700,"y":700},"camera":[[0.5833333,0,0],[0,-0.5833333,0],[58.333332,641.6666,1]],"edges":[],"rays":[],"dots":[{"x":758.28906,"y":666.34875},{"x":518.4389,"y":499.8575},{"x":267.87012,"y":335.9736},{"x":102.9719,"y":732.7018},{"x":350.54935,"y":727.7027},{"x":859.1447,"y":751.1207},{"x":484.4098,"y":493.3175},{"x":616.4247,"y":368.60236},{"x":829.498,"y":605.81726},{"x":270.16656,"y":539.4208},{"x":590.1448,"y":899.348},{"x":134.978,"y":834.6334},{"x":371.25513,"y":297.9135},{"x":358.11417,"y":751.3825},{"x":784.2785,"y":316.7663},{"x":860.0369,"y":364.58325},{"x":169.92209,"y":820.9189},{"x":564.0213,"y":492.74142},{"x":570.8803,"y":762.6122},{"x":876.72327,"y":346.32733},{"x":322.0231,"y":843.07},{"x":727.5148,"y":848.2517},{"x":885.4862,"y":306.745},{"x":260.33154,"y":471.42035},{"x":509.31912,"y":435.07556},{"x":350.67212,"y":433.2179},{"x":785.9657,"y":254.52391},{"x":837.3776,"y":758.941},{"x":631.3708,"y":583.8054},{"x":228.60242,"y":869.9566},{"x":877.8594,"y":251.58939},{"x":848.42334,"y":133.78305},{"x":767.66583,"y":594.5615},{"x":681.19867,"y":563.4909},{"x":829.29626,"y":223.68329},{"x":697.72205,"y":166.8858},{"x":629.09393,"y":823.8392},{"x":317.3977,"y":647.07477},{"x":271.83325,"y":186.72629},{"x":849.1473,"y":164.51013},{"x":137.58197,"y":786.69385},{"x":342.0634,"y":449.20288},{"x":866.09424,"y":526.819},{"x":478.61755,"y":815.3982},{"x":883.5413,"y":705.08026},{"x":761.37067,"y":887.0749},{"x":634.00977,"y":106.76667}],"polygons":[{"dots":[{"x":750.422,"y":47.21647},{"x":756.37134,"y":0},{"x":420.5235,"y":0},{"x":448.88324,"y":128.45532},{"x":523.36847,"y":230.84428},{"x":573.94495,"y":234.24104}]},{"dots":[{"x":756.37134,"y":0},{"x":750.422,"y":47.21647},{"x":773.2029,"y":150.92711},{"x":1000,"y":145.58362},{"x":999.9999,"y":0}]},{"dots":[{"x":1000,"y":145.58362},{"x":773.2029,"y":150.92711},{"x":773.53455,"y":172.06262},{"x":872.2334,"y":205.17122},{"x":1000,"y":163.0431}]},{"dots":[{"x":750.422,"y":47.21647},{"x":573.94495,"y":234.24104},{"x":677.1572,"y":275.83844},{"x":768.39185,"y":183.97354},{"x":773.53455,"y":172.06262},{"x":773.2029,"y":150.92711}]},{"dots":[{"x":448.88324,"y":128.45532},{"x":420.5235,"y":0},{"x":3.5925057E-06,"y":0},{"x":0,"y":254.18422},{"x":299.38513,"y":262.1342}]},{"dots":[{"x":872.2334,"y":205.17122},{"x":773.53455,"y":172.06262},{"x":768.39185,"y":183.97354},{"x":832.5867,"y":274.16595}]},{"dots":[{"x":1000,"y":163.0431},{"x":872.2334,"y":205.17122},{"x":832.5867,"y":274.16595},{"x":832.9615,"y":285.90417},{"x":1000,"y":262.80527}]},{"dots":[{"x":832.5867,"y":274.16595},{"x":768.39185,"y":183.97354},{"x":677.1572,"y":275.83844},{"x":681.8727,"y":282.84644},{"x":832.42395,"y":286.9273},{"x":832.9615,"y":285.90417}]},{"dots":[{"x":448.88324,"y":128.45532},{"x":299.38513,"y":262.1342},{"x":336.0681,"y":361.77844},{"x":430.67447,"y":376.17038},{"x":502.23578,"y":304.13858},{"x":523.36847,"y":230.84428}]},{"dots":[{"x":1000,"y":262.80527},{"x":832.9615,"y":285.90417},{"x":832.42395,"y":286.9273},{"x":835.3427,"y":316.4052},{"x":1000,"y":352.85797}]},{"dots":[{"x":832.42395,"y":286.9273},{"x":681.8727,"y":282.84644},{"x":730.10406,"y":439.02792},{"x":753.82446,"y":448.93814},{"x":833.15204,"y":323.2559},{"x":835.3427,"y":316.4052}]},{"dots":[{"x":299.38513,"y":262.1342},{"x":0,"y":254.18422},{"x":0,"y":388.99786},{"x":285.4432,"y":404.88483},{"x":336.0681,"y":361.77844}]},{"dots":[{"x":1000,"y":352.85797},{"x":835.3427,"y":316.4052},{"x":833.15204,"y":323.2559},{"x":963.03143,"y":441.96875},{"x":1000,"y":444.14584}]},{"dots":[{"x":963.03143,"y":441.96875},{"x":833.15204,"y":323.2559},{"x":753.82446,"y":448.93814},{"x":754.7232,"y":449.74622}]},{"dots":[{"x":677.1572,"y":275.83844},{"x":573.94495,"y":234.24104},{"x":523.36847,"y":230.84428},{"x":502.23578,"y":304.13858},{"x":577.40955,"y":425.26294},{"x":662.91693,"y":461.3585},{"x":730.10406,"y":439.02792},{"x":681.8727,"y":282.84644}]},{"dots":[{"x":430.67447,"y":376.17038},{"x":336.0681,"y":361.77844},{"x":285.4432,"y":404.88483},{"x":287.36768,"y":409.43576},{"x":411.65308,"y":476.36987},{"x":429.9787,"y":435.59058}]},{"dots":[{"x":577.40955,"y":425.26294},{"x":502.23578,"y":304.13858},{"x":430.67447,"y":376.17038},{"x":429.9787,"y":435.59058},{"x":506.83038,"y":468.45883},{"x":536.2375,"y":464.319}]},{"dots":[{"x":411.65308,"y":476.36987},{"x":287.36768,"y":409.43576},{"x":311.63583,"y":498.71155},{"x":381.80368,"y":554.63},{"x":387.19125,"y":555.3016}]},{"dots":[{"x":285.4432,"y":404.88483},{"x":0,"y":388.99786},{"x":0,"y":492.65924},{"x":68.44985,"y":533.884},{"x":311.63583,"y":498.71155},{"x":287.36768,"y":409.43576}]},{"dots":[{"x":577.40955,"y":425.26294},{"x":536.2375,"y":464.319},{"x":552.9493,"y":571.3671},{"x":631.6306,"y":513.17596},{"x":662.91693,"y":461.3585}]},{"dots":[{"x":506.83038,"y":468.45883},{"x":429.9787,"y":435.59058},{"x":411.65308,"y":476.36987},{"x":387.19125,"y":555.3016},{"x":460.79056,"y":635.2456},{"x":473.3926,"y":642.4428}]},{"dots":[{"x":536.2375,"y":464.319},{"x":506.83038,"y":468.45883},{"x":473.3926,"y":642.4428},{"x":476.61313,"y":644.8158},{"x":502.13843,"y":639.7213},{"x":552.9493,"y":571.3671}]},{"dots":[{"x":963.03143,"y":441.96875},{"x":754.7232,"y":449.74622},{"x":760.47205,"y":478.73096},{"x":808.0956,"y":547.9267},{"x":940.959,"y":609.4761},{"x":1000,"y":603.69745},{"x":1000,"y":444.14584}]},{"dots":[{"x":311.63583,"y":498.71155},{"x":68.44985,"y":533.884},{"x":189.80916,"y":638.86395},{"x":381.80368,"y":554.63}]},{"dots":[{"x":730.10406,"y":439.02792},{"x":662.91693,"y":461.3585},{"x":631.6306,"y":513.17596},{"x":684.02515,"y":641.6905},{"x":708.5086,"y":623.3405},{"x":760.47205,"y":478.73096},{"x":754.7232,"y":449.74622},{"x":753.82446,"y":448.93814}]},{"dots":[{"x":631.6306,"y":513.17596},{"x":552.9493,"y":571.3671},{"x":502.13843,"y":639.7213},{"x":652.27325,"y":690.5121},{"x":684.02515,"y":641.6905}]},{"dots":[{"x":808.0956,"y":547.9267},{"x":760.47205,"y":478.73096},{"x":708.5086,"y":623.3405},{"x":792.37354,"y":634.2948}]},{"dots":[{"x":940.959,"y":609.4761},{"x":808.0956,"y":547.9267},{"x":792.37354,"y":634.2948},{"x":824.9611,"y":672.63074}]},{"dots":[{"x":381.80368,"y":554.63},{"x":189.80916,"y":638.86395},{"x":214.05629,"y":699.58325},{"x":235.21335,"y":726.8315},{"x":236.13779,"y":727.61566},{"x":460.79056,"y":635.2456},{"x":387.19125,"y":555.3016}]},{"dots":[{"x":792.37354,"y":634.2948},{"x":708.5086,"y":623.3405},{"x":684.02515,"y":641.6905},{"x":652.27325,"y":690.5121},{"x":670.5644,"y":726.122},{"x":699.6514,"y":749.9831},{"x":745.1152,"y":757.6747},{"x":817.8834,"y":695.5187},{"x":824.9611,"y":672.63074}]},{"dots":[{"x":940.959,"y":609.4761},{"x":824.9611,"y":672.63074},{"x":817.8834,"y":695.5187},{"x":830.8835,"y":706.6612},{"x":1000,"y":796.2753},{"x":1000,"y":603.69745}]},{"dots":[{"x":460.79056,"y":635.2456},{"x":236.13779,"y":727.61566},{"x":255.66356,"y":765.45123},{"x":265.56638,"y":767.89984},{"x":459.50894,"y":705.9424},{"x":469.1616,"y":691.8459},{"x":476.61313,"y":644.8158},{"x":473.3926,"y":642.4428}]},{"dots":[{"x":189.80916,"y":638.86395},{"x":68.44985,"y":533.884},{"x":0,"y":492.65924},{"x":0,"y":821.02545},{"x":48.23071,"y":805.881},{"x":214.05629,"y":699.58325}]},{"dots":[{"x":1000,"y":796.2753},{"x":830.8835,"y":706.6612},{"x":892.53766,"y":878.271},{"x":1000,"y":955.5547}]},{"dots":[{"x":459.50894,"y":705.9424},{"x":265.56638,"y":767.89984},{"x":398.74567,"y":820.32336}]},{"dots":[{"x":892.53766,"y":878.271},{"x":830.8835,"y":706.6612},{"x":817.8834,"y":695.5187},{"x":745.1152,"y":757.6747},{"x":797.1576,"y":821.6932}]},{"dots":[{"x":652.27325,"y":690.5121},{"x":502.13843,"y":639.7213},{"x":476.61313,"y":644.8158},{"x":469.1616,"y":691.8459},{"x":551.1321,"y":835.1194},{"x":556.7585,"y":834.3268},{"x":670.5644,"y":726.122}]},{"dots":[{"x":214.05629,"y":699.58325},{"x":48.23071,"y":805.881},{"x":145.9398,"y":811.18835},{"x":235.21335,"y":726.8315}]},{"dots":[{"x":551.1321,"y":835.1194},{"x":469.1616,"y":691.8459},{"x":459.50894,"y":705.9424},{"x":398.74567,"y":820.32336},{"x":429.83575,"y":996.26166}]},{"dots":[{"x":235.21335,"y":726.8315},{"x":145.9398,"y":811.18835},{"x":172.12607,"y":877.90985},{"x":253.4599,"y":780.5829},{"x":255.66356,"y":765.45123},{"x":236.13779,"y":727.61566}]},{"dots":[{"x":670.5644,"y":726.122},{"x":556.7585,"y":834.3268},{"x":664.895,"y":890.106},{"x":699.6514,"y":749.9831}]},{"dots":[{"x":145.9398,"y":811.18835},{"x":48.23071,"y":805.881},{"x":0,"y":821.02545},{"x":0,"y":1000},{"x":126.06328,"y":1000},{"x":172.12607,"y":877.90985}]},{"dots":[{"x":398.74567,"y":820.32336},{"x":265.56638,"y":767.89984},{"x":255.66356,"y":765.45123},{"x":253.4599,"y":780.5829},{"x":316.60852,"y":1000},{"x":429.05106,"y":1000},{"x":429.83575,"y":996.26166}]},{"dots":[{"x":745.1152,"y":757.6747},{"x":699.6514,"y":749.9831},{"x":664.895,"y":890.106},{"x":678.07495,"y":925.5396},{"x":797.1576,"y":821.6932}]},{"dots":[{"x":253.4599,"y":780.5829},{"x":172.12607,"y":877.90985},{"x":126.06328,"y":1000},{"x":316.60852,"y":1000}]},{"dots":[{"x":797.1576,"y":821.6932},{"x":678.07495,"y":925.5396},{"x":683.4123,"y":1000},{"x":999.99994,"y":1000},{"x":1000,"y":955.5547},{"x":892.53766,"y":878.271}]},{"dots":[{"x":664.895,"y":890.106},{"x":556.7585,"y":834.3268},{"x":551.1321,"y":835.1194},{"x":429.83575,"y":996.26166},{"x":429.05106,"y":1000},{"x":683.4123,"y":1000},{"x":678.07495,"y":925.5396}]}],"arcs":[],"circles":[],"lines":[]};
var camera = [[1,0,0],[0,1,0],[0,0,1]];
var reverseCamera;

var matrixMult = function(x,y,m){
	return {
		"x":m[0][0]*x+m[1][0]*y+m[2][0],
		"y":m[0][1]*x+m[1][1]*y+m[2][1]
	};
};
var coordToCamera = function(x,y){
	return matrixMult(x,y,camera);
};
var scaleCoord = function(x,y){
	var c = camera;
	return {
		"x":c[0][0]*x+c[1][0]*y,
		"y":c[0][1]*x+c[1][1]*y
	};
}
var polygonColors = ["#CD5C5C", "#ADFF2F", "#7B68EE", "#FFA500",
"#F08080", "#00FF00", "#4682B4", "#A52A2A",
"#E9967A", "#32CD32", "#87CEFA", "#D2691E",
"#DC143C", "#00FA9A", "#4169E1",
"#B22222", "#9ACD32", "#FFD700",
"#FF69B4", "#808000", "#FFDAB9",
"#C71585", "#66CDAA", "#F0E68C",
"#DB7093", "#008B8B", "#9370DB"]; 
var getRayMult = function(){
	return 1000/(Math.abs(camera[0][0])+Math.abs(camera[0][1])+Math.abs(camera[1][0])+Math.abs(camera[1][1]));
};

var getMinor = function(m, x, y){
	var x1 = (x+1)%3;
	var x2 = (x+2)%3;
	var y1 = (y+1)%3;
	var y2 = (y+2)%3;
	return m[x1][y1]*m[x2][y2] - m[x1][y2]*m[x2][y1];
};
var getMinorMatrix = function(m){
	var result = [];
	for(var i = 0; i < 3; i++){
		result[i] = [];
		for(var j = 0; j < 3; j++){
			result[i][j] = getMinor(m, i, j);
		}
	}
	return result;
};
var backMatrix = function(m){	
	var mmin = getMinorMatrix(m);	
	var det = m[0][0] * mmin[0][0] - m[0][1] * mmin[0][1] + m[0][2] * mmin[0][2];	
	var result = [];
	for(var i = 0; i < 3; i++){
		result[i] = [];
		for(var j = 0; j < 3; j++){
			result[i][j] = mmin[j][i] / det * ((i+j)%2==0?1:-1);
		}
	}
	return result;		
};
window.onload = function() {
	var drawingCanvas = document.getElementById('smile');
	var coord;
	if(drawingCanvas && drawingCanvas.getContext) {
		var context = drawingCanvas.getContext('2d');
		if(outputRepr.camera!==undefined){
			for(var i = 0; i < 3; i++){
				for(var j = 0; j < 3; j++){
					if(outputRepr.camera[i][j] !== undefined){
						camera[i][j] = outputRepr.camera[i][j];
					}
				}
			}
		}
		reverseCamera = backMatrix(camera);
		if(outputRepr.size!==undefined){
			drawingCanvas.width = outputRepr.size.x;
			drawingCanvas.height = outputRepr.size.y;
		}
		var rayMult = getRayMult();		
		var minCorner = matrixMult(0, 0, reverseCamera);
		var maxCorner = matrixMult(drawingCanvas.width, drawingCanvas.height, reverseCamera);
		var xMin = Math.min(minCorner.x, maxCorner.x);
		var xMax = Math.max(minCorner.x, maxCorner.x);
		var xStep = (xMax - xMin) / drawingCanvas.width;
		var yMin = Math.min(minCorner.y, maxCorner.y);
		var yMax = Math.max(minCorner.y, maxCorner.y);
		
		context.shadowColor = "rgba(0,0,0,.5)";
		context.shadowBlur = 2;
		context.lineCap = 'round';
		context.lineJoin = 'round';
		context.lineWidth = 1;
		
		if(outputRepr.polygons!==undefined){
			for(var polyId = 0; polyId < outputRepr.polygons.length; polyId++){
				var poly = outputRepr.polygons[polyId];
				context.fillStyle = polygonColors[polyId % polygonColors.length];				
				
				context.beginPath();
				coord = coordToCamera(poly.dots[0].x, poly.dots[0].y);
				context.moveTo(coord.x, coord.y);
				for(var dotId = 1; dotId < poly.dots.length; dotId++){
					coord = coordToCamera(poly.dots[dotId].x, poly.dots[dotId].y);
					context.lineTo(coord.x, coord.y);
				}
				context.closePath();
				context.fill();
			}
		}
		if(outputRepr.edges!==undefined){
			context.strokeStyle = "#AA0";
			
			outputRepr.edges.forEach((elem)=>{				
				context.beginPath();
				coord = coordToCamera(elem.x1, elem.y1);
				context.moveTo(coord.x, coord.y);
				coord = coordToCamera(elem.x2, elem.y2);
				context.lineTo(coord.x, coord.y);				
				context.stroke();
			});
		}
		if(outputRepr.rays!==undefined){
			context.strokeStyle = "#0AA";
			
			outputRepr.rays.forEach((elem)=>{				
				context.beginPath();
				coord = coordToCamera(elem.x, elem.y);
				context.moveTo(coord.x, coord.y);
				var rayCoord = coordToCamera(elem.x+elem.dx*rayMult, elem.y+elem.dy*rayMult);
				context.lineTo(rayCoord.x, rayCoord.y);
				context.lineCap = 'round';
				context.stroke();
			});
		}	
		if(outputRepr.lines!==undefined){
			context.strokeStyle = "#AAA";
			
			outputRepr.lines.forEach((elem)=>{
				var x, y;
				var coord1, coord2;
				if(Math.abs(elem.dx) > Math.abs(elem.dy)){
					coord1 = coordToCamera((-elem.dy * yMin - elem.c) / elem.dx, yMin);
					coord2 = coordToCamera((-elem.dy * yMax - elem.c) / elem.dx, yMax);
				}else{
					coord1 = coordToCamera(xMin, (-elem.dx * xMin - elem.c) / elem.dy);
					coord2 = coordToCamera(xMax, (-elem.dx * xMax - elem.c) / elem.dy);
				}
				context.beginPath();
				context.moveTo(coord1.x, coord1.y);
				context.lineTo(coord2.x, coord2.y);
				context.stroke();
			});
		}
		if(outputRepr.circles!==undefined){
			context.setLineDash([5,5]);
			context.strokeStyle = "#A00";
			
			outputRepr.circles.forEach((elem)=>{
				var coord = coordToCamera(elem.x, elem.y);
				var size = scaleCoord(1, 1);
				context.beginPath();
				context.ellipse(coord.x, coord.y, elem.r*Math.abs(size.x), elem.r*Math.abs(size.y), 0, 0, Math.PI*2);
				context.stroke();
			});
			context.setLineDash([]);
		}
		if(outputRepr.arcs!==undefined){
			context.strokeStyle = "#00A";

			outputRepr.arcs.forEach((elem)=>{
				context.beginPath();
				drawMinX = Math.max(elem.minX, xMin);
				drawMaxX = Math.min(elem.maxX, xMax);
				var count = 0;
				for(var x = drawMinX; x < drawMaxX+xStep; x += xStep){
					var y = .5 * ((x - elem.fX) * (x - elem.fX) 
						+ elem.fY * elem.fY - elem.dirY * elem.dirY)
						/ (elem.fY - elem.dirY);
					var coord = coordToCamera(x,y);
					if(count==0){
						context.moveTo(coord.x, coord.y);
					}else{
						context.lineTo(coord.x, coord.y);
					}
					count++;
				}
				//context.closePath();
				context.stroke();
			});
		}
		if(outputRepr.dots!==undefined){
			context.fillStyle = "#FFF";
			context.strokeStyle = "#000";
			
			outputRepr.dots.forEach((elem)=>{				
				coord = coordToCamera(elem.x, elem.y);
				context.beginPath();
				context.arc(coord.x, coord.y, 3, 0, Math.PI*2);
				context.fill();
				context.stroke();				
			});
		}
	}
}
  </script>
 </head>
 <body>
  <canvas id="smile" width="200" height="200">
    <p>Ваш браузер не поддерживает рисование.</p>
  </canvas>
 </body>
</html>